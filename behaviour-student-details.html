<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Student Behaviour Details</title>
  <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet" />
  <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
  <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-firestore.js"></script>
</head>
<body class="bg-gray-100 p-6">
  <div class="max-w-4xl mx-auto bg-white shadow-lg rounded-lg p-8">
    <button onclick="window.location.href='behaviourdatabase.html'" class="mb-6 text-blue-600 hover:underline">‚Üê Back to Behaviour Database</button>
    <h1 class="text-3xl font-bold mb-4" id="studentName">Loading...</h1>
    <p id="studentDetails" class="mb-6 text-gray-700"></p>

    <div id="behaviourContent">
      <h2 class="text-xl font-semibold mt-6 mb-2">Behaviour Incidents</h2>
      <ul id="incidentList" class="list-disc pl-6 space-y-2 text-gray-800"></ul>

      <h2 class="text-xl font-semibold mt-6 mb-2">Isolations</h2>
      <ul id="isolationList" class="list-disc pl-6 space-y-2 text-gray-800"></ul>

      <h2 class="text-xl font-semibold mt-6 mb-2">Exclusions</h2>
      <ul id="exclusionList" class="list-disc pl-6 space-y-2 text-gray-800"></ul>
    </div>
  </div>

  <script>
    const firebaseConfig = {
      apiKey: "AIzaSyCuoUMX1iWfNYrX4FdFLlFjX-7yEumg0dc",
      authDomain: "pastoraldatabase.firebaseapp.com",
      projectId: "pastoraldatabase",
      storageBucket: "pastoraldatabase.firebasestorage.app",
      messagingSenderId: "859785843482",
      appId: "1:859785843482:web:4e0e5458391c1daee592a3",
      measurementId: "G-54LQVPWPJH"
    };
    firebase.initializeApp(firebaseConfig);
    const db = firebase.firestore();

    const urlParams = new URLSearchParams(window.location.search);
    const studentId = urlParams.get('id');

    const studentName = document.getElementById('studentName');
    const studentDetails = document.getElementById('studentDetails');
    const incidentList = document.getElementById('incidentList');
    const isolationList = document.getElementById('isolationList');
    const exclusionList = document.getElementById('exclusionList');

    async function loadStudentDetails() {
      try {
        const doc = await db.collection('students').doc(studentId).get();
        if (!doc.exists) {
          studentName.textContent = "Student not found";
          return;
        }

        const data = doc.data();
        studentName.textContent = data.name;
        studentDetails.textContent = `Year: ${data.year || 'N/A'} | Timeout Pass: ${data.timeoutPass || 'N/A'}`;

        const formatEntry = (entry) => {
          const date = entry.timestamp?.toDate().toLocaleString() || 'Unknown date';
          return `${entry.text || entry.reason} (${date})`;
        };

        // Behaviour incidents
        (data.behaviourIncidents || []).forEach(incident => {
          const li = document.createElement('li');
          li.textContent = formatEntry(incident);
          incidentList.appendChild(li);
        });

        // Isolations
        (data.isolations || []).forEach(isolation => {
          const li = document.createElement('li');
          li.textContent = formatEntry(isolation);
          isolationList.appendChild(li);
        });

        // Exclusions
        (data.exclusions || []).forEach(exclusion => {
          const li = document.createElement('li');
          li.textContent = formatEntry(exclusion);
          exclusionList.appendChild(li);
        });

      } catch (err) {
        console.error("Error loading student data:", err);
        studentName.textContent = "Failed to load student data.";
      }
    }

    loadStudentDetails();
  </script>
</body>
</html>
